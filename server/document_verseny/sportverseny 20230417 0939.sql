--
-- Script was generated by Devart dbForge Studio 2019 for MySQL, Version 8.1.22.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 2023.04.17. 9:39:35
-- Server version: 5.5.5-10.4.27-MariaDB
-- Client version: 4.1
--

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set SQL mode
-- 
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

DROP DATABASE IF EXISTS sportverseny;

CREATE DATABASE IF NOT EXISTS sportverseny
	CHARACTER SET utf8
	COLLATE utf8_hungarian_ci;

--
-- Set default database
--
USE sportverseny;

--
-- Create table `users`
--
CREATE TABLE IF NOT EXISTS users (
  id INT(11) NOT NULL,
  firstName VARCHAR(255) DEFAULT NULL,
  lastName VARCHAR(255) DEFAULT NULL,
  gender VARCHAR(255) DEFAULT NULL,
  userName VARCHAR(255) DEFAULT NULL,
  email VARCHAR(50) DEFAULT NULL,
  password VARCHAR(255) DEFAULT NULL,
  number INT(11) DEFAULT NULL,
  PRIMARY KEY (id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 2730,
CHARACTER SET utf8,
COLLATE utf8_hungarian_ci;

--
-- Create table `races`
--
CREATE TABLE IF NOT EXISTS races (
  id INT(11) NOT NULL AUTO_INCREMENT,
  raceName VARCHAR(255) DEFAULT NULL,
  raceDateFrom DATETIME DEFAULT NULL,
  raceDateUpTo DATETIME DEFAULT NULL,
  institution VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 2,
CHARACTER SET utf8,
COLLATE utf8_hungarian_ci;

--
-- Create table `teams`
--
CREATE TABLE IF NOT EXISTS teams (
  id INT(11) NOT NULL AUTO_INCREMENT,
  RaceId INT(11) DEFAULT NULL,
  temamName VARCHAR(255) DEFAULT NULL,
  Institution VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 9,
AVG_ROW_LENGTH = 2048,
CHARACTER SET utf8,
COLLATE utf8_hungarian_ci;

--
-- Create foreign key
--
ALTER TABLE teams 
  ADD CONSTRAINT FK_teams_races_id FOREIGN KEY (RaceId)
    REFERENCES races(id);

--
-- Create table `competitionnumbers`
--
CREATE TABLE IF NOT EXISTS competitionnumbers (
  id INT(11) NOT NULL AUTO_INCREMENT,
  raceNumber VARCHAR(255) DEFAULT NULL,
  weighting INT(11) DEFAULT NULL,
  moreIsBetter INT(11) DEFAULT NULL,
  type INT(11) DEFAULT NULL,
  userId INT(11) DEFAULT NULL,
  racesId INT(11) DEFAULT NULL,
  PRIMARY KEY (id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 7,
AVG_ROW_LENGTH = 2730,
CHARACTER SET utf8,
COLLATE utf8_hungarian_ci;

--
-- Create foreign key
--
ALTER TABLE competitionnumbers 
  ADD CONSTRAINT FK_competitionnumbers_races_id FOREIGN KEY (racesId)
    REFERENCES races(id);

--
-- Create foreign key
--
ALTER TABLE competitionnumbers 
  ADD CONSTRAINT FK_competitionnumbers_users_id FOREIGN KEY (userId)
    REFERENCES users(id);

--
-- Create table `teamrace`
--
CREATE TABLE IF NOT EXISTS teamrace (
  teamId INT(11) DEFAULT NULL,
  competitionNumberId INT(11) DEFAULT NULL,
  resultNumber DECIMAL(10, 0) DEFAULT NULL,
  resultTime TIME DEFAULT NULL,
  place INT(11) DEFAULT 0,
  id INT(11) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 97,
AVG_ROW_LENGTH = 341,
CHARACTER SET utf8,
COLLATE utf8_hungarian_ci;

--
-- Create foreign key
--
ALTER TABLE teamrace 
  ADD CONSTRAINT FK_teamrace_competitionnumbers_id FOREIGN KEY (competitionNumberId)
    REFERENCES competitionnumbers(id) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE teamrace 
  ADD CONSTRAINT FK_teamrace_teams_id FOREIGN KEY (teamId)
    REFERENCES teams(id) ON DELETE NO ACTION ON UPDATE NO ACTION;

DELIMITER $$

--
-- Create function `RandomInteger`
--
CREATE DEFINER = ''@''
FUNCTION IF NOT EXISTS RandomInteger(min INT, max INT)
  RETURNS int(11)
BEGIN

RETURN Floor(min + Rand() * (max-min+1));
END
$$

--
-- Create procedure `csvGenerator`
--
CREATE DEFINER = ''@''
PROCEDURE csvGenerator()
BEGIN

DELETE
  FROM teamrace;

  set @teamscount =  ( SELECT
    COUNT(*) darab
  FROM teams
  WHERE RaceId = 1);
  set @competitionCount = ( SELECT
    COUNT(*) db
  FROM competitionnumbers);
  set @t = 1;

  teams_loop: LOOP
  

      set @c = 1;
      competition_loop: LOOP

#ide jön az insert

INSERT INTO teamrace (teamId, competitionNumberId, resultNumber)
  VALUES (@t, @c, RandomInteger(1, 10));
          SET @c=@c+1;
         IF @c>@competitionCount THEN
          LEAVE competition_loop;
       END IF;
    END LOOP competition_loop;
        SET @t=@t+1;

   IF @t>@teamscount THEN
      LEAVE teams_loop;
   END IF;
END LOOP teams_loop;


  

END
$$

DELIMITER ;

-- 
-- Dumping data for table users
--
INSERT INTO users VALUES
(1, 'Marton', 'Elek', 'Férfi', 'elekMarton', 'elekMarton@gmail.com', 'marton_elek', 11),
(2, 'Fütty', 'Mihály', 'Férfi', 'mihalyFutty', 'mihalyFutty@gmail.com', 'futty_mihaly', 22),
(3, 'Bakó', 'Judit', 'Nő', 'juditBako', 'juditBako@gmail.com', 'bako_judit', 33),
(4, 'Szabó', 'Tamás', 'Férfi', 'tamasSzabo', 'tamasSzabo@gmail.com', 'szabo_tamas', 44),
(5, 'Korom', 'Dániel', 'Férfi', 'danielKorom', 'danielKorom@gmail.com', 'korom_daniel', 55),
(6, 'Katona', 'Maria', 'Nő', 'mariaKatona', 'mariaKatona@gmail.com', 'katona_maria', 66);

-- 
-- Dumping data for table races
--
INSERT INTO races VALUES
(1, 'Legnagyobb Verseny', '2012-03-25 00:00:00', '2012-03-26 00:00:00', 'Karcagi Szakképzési Centrum Nagy László Gimnázium');

-- 
-- Dumping data for table teams
--
INSERT INTO teams VALUES
(1, 1, 'Ewengers', 'Szolnoki Műszaki Szakképzési Centrum Rózsa Imre Középiskolája és Kollégiuma'),
(2, 1, 'MRK fiúk', 'Mezőtúri Református Kollégium, Gimnázium, Szakközépiskola, Általános Iskola és Óvoda'),
(3, 1, 'Kinizsi fiúk', 'Kinizsi Pál Gimnázium és Szakközépiskola'),
(4, 1, 'Csavarkulcs', 'Szolnoki Műszaki Szakképzési Centrum Jendrassik György Gépipari Szakközépiskolája'),
(5, 1, 'Magára bízom', 'Hajnóczy József Gimnázium, Humán Szakközépiskola és Kollégium'),
(6, 1, 'Fahéj', 'Szolnoki Műszaki Szakképzési Centrum Petőfi Sándor Építészeti és Faipari Szakképző Iskolája'),
(7, 1, 'Másnaposok', 'Szolnoki Műszaki Szakképzési Centrum Baross Gábor Gépipari, Közlekedési Szakképző Iskolája'),
(8, 1, 'Konok-kunok', 'Karcagi Szakképzési Centrum Nagy László Gimnázium');

-- 
-- Dumping data for table competitionnumbers
--
INSERT INTO competitionnumbers VALUES
(1, 'Lövészet', 1, 1, 0, 1, 1),
(2, 'Akadálypálya', 2, 0, 0, 2, 1),
(3, 'Gránátdobás', 1, 1, 0, 3, 1),
(4, 'Fegyverszerelés', 1, 0, 0, 4, 1),
(5, 'Elsősegély', 1, 1, 0, 5, 1),
(6, 'Katonai alapismeretek', 2, 1, 0, 6, 1);

-- 
-- Dumping data for table teamrace
--
INSERT INTO teamrace VALUES
(1, 1, 0, NULL, 1, 49),
(1, 2, 100000, NULL, 0, 50),
(1, 3, 0, NULL, 0, 51),
(1, 4, 100000, NULL, 0, 52),
(1, 5, 0, NULL, 0, 53),
(1, 6, 0, NULL, 0, 54),
(2, 1, 0, NULL, 4, 55),
(2, 2, 100000, NULL, 0, 56),
(2, 3, 0, NULL, 0, 57),
(2, 4, 100000, NULL, 0, 58),
(2, 5, 0, NULL, 0, 59),
(2, 6, 0, NULL, 0, 60),
(3, 1, 0, NULL, 2, 61),
(3, 2, 100000, NULL, 0, 62),
(3, 3, 0, NULL, 0, 63),
(3, 4, 100000, NULL, 0, 64),
(3, 5, 0, NULL, 0, 65),
(3, 6, 0, NULL, 0, 66),
(4, 1, 0, NULL, 0, 67),
(4, 2, 100000, NULL, 0, 68),
(4, 3, 0, NULL, 0, 69),
(4, 4, 100000, NULL, 0, 70),
(4, 5, 0, NULL, 0, 71),
(4, 6, 0, NULL, 0, 72),
(5, 1, 0, NULL, 0, 73),
(5, 2, 100000, NULL, 0, 74),
(5, 3, 0, NULL, 0, 75),
(5, 4, 100000, NULL, 0, 76),
(5, 5, 0, NULL, 0, 77),
(5, 6, 0, NULL, 0, 78),
(6, 1, 0, NULL, 4, 79),
(6, 2, 100000, NULL, 0, 80),
(6, 3, 0, NULL, 0, 81),
(6, 4, 100000, NULL, 0, 82),
(6, 5, 0, NULL, 0, 83),
(6, 6, 0, NULL, 0, 84),
(7, 1, 0, NULL, 3, 85),
(7, 2, 100000, NULL, 0, 86),
(7, 3, 0, NULL, 0, 87),
(7, 4, 100000, NULL, 0, 88),
(7, 5, 0, NULL, 0, 89),
(7, 6, 0, NULL, 0, 90),
(8, 1, 0, NULL, 0, 91),
(8, 2, 100000, NULL, 0, 92),
(8, 3, 0, NULL, 0, 93),
(8, 4, 100000, NULL, 0, 94),
(8, 5, 0, NULL, 0, 95),
(8, 6, 0, NULL, 0, 96);

-- 
-- Restore previous SQL mode
-- 
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;